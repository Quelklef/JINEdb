<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Example | jinedb</title>
	<meta name="description" content="Documentation for jinedb">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">jinedb</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../globals.html">Globals</a>
				</li>
				<li>
					<a href="introduction.html">Overview</a>
				</li>
				<li>
					<a href="example.html">Example</a>
				</li>
			</ul>
			<h1>Example</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p>First, check out <a href="installation.html">Installation</a>.</p>
				<p>Now, here&#39;s a 5-minute rundown of what Jine has to offer, and how to use it:</p>
				<pre><code class="language-ts"><span class="hljs-keyword">import</span> { codec, encodesTo, NativelyStorable, NativelyIndexable, MigrationTx, Database, Connection, Store, Index, Transaction } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jinedb&#x27;</span>;
<span class="hljs-keyword">const</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;assert&#x27;</span>).strict;


<span class="hljs-comment">// == // == // INITIALIZATION // == // == //</span>

<span class="hljs-comment">// What we&#x27;ll be storing</span>
<span class="hljs-keyword">class</span> Recipe {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span>,
    <span class="hljs-keyword">public</span> url: <span class="hljs-built_in">string</span>,
    <span class="hljs-keyword">public</span> servings: <span class="hljs-built_in">number</span>,
    <span class="hljs-keyword">public</span> ingredients: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;,
  </span>) { }
}

<span class="hljs-comment">// Let typescript know what our database will looks like</span>
<span class="hljs-keyword">interface</span> $$ {
  recipes: Store&lt;Recipe&gt; &amp; {
    by: {
      name: Index&lt;Recipe, <span class="hljs-built_in">string</span>&gt;;
      servings: Index&lt;Recipe, <span class="hljs-built_in">number</span>&gt;;
      ingredients: Index&lt;Recipe, <span class="hljs-built_in">string</span>&gt;;
      ingredientCount: Index&lt;Recipe, <span class="hljs-built_in">number</span>&gt;;
    }
  };
}

<span class="hljs-comment">// Define the database migrations</span>
<span class="hljs-keyword">const</span> migrations = [
  <span class="hljs-keyword">async</span> (genuine: <span class="hljs-built_in">boolean</span>, tx: MigrationTx) =&gt; {
    <span class="hljs-comment">// Create a item store for recipes</span>
    <span class="hljs-keyword">const</span> recipes = tx.addStore&lt;Recipe&gt;(<span class="hljs-string">&#x27;recipes&#x27;</span>);

    <span class="hljs-comment">// Track recipes by their name</span>
    <span class="hljs-comment">// Require names to be unique</span>
    <span class="hljs-keyword">await</span> recipes.addIndex&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;.name&#x27;</span>, { unique: <span class="hljs-literal">true</span> });

    <span class="hljs-comment">// Track recipes by their serving count</span>
    <span class="hljs-keyword">await</span> recipes.addIndex&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">&#x27;servings&#x27;</span>, <span class="hljs-string">&#x27;.servings&#x27;</span>);

    <span class="hljs-comment">// Track recipes by their ingredients</span>
    <span class="hljs-keyword">await</span> recipes.addIndex&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&#x27;ingredients&#x27;</span>, <span class="hljs-string">&#x27;.ingredients&#x27;</span>, { explode: <span class="hljs-literal">true</span> });
    <span class="hljs-comment">// ^^ The flag &#x27;explode: true&#x27; means that a recipe where</span>
    <span class="hljs-comment">//  recipe.ingredients = [&#x27;milk&#x27;, &#x27;chocolate&#x27;]</span>
    <span class="hljs-comment">// will get indexed for &#x27;milk&#x27; and &#x27;chocolate&#x27; individually</span>
    <span class="hljs-comment">// rather than indexed for the array as a whole</span>

    <span class="hljs-comment">// Track recipes by their ingredient count</span>
    <span class="hljs-keyword">await</span> recipes.addIndex&lt;<span class="hljs-built_in">number</span>&gt;(
      <span class="hljs-string">&#x27;ingredientCount&#x27;</span>,
      <span class="hljs-function">(<span class="hljs-params">recipe: Recipe</span>) =&gt;</span> recipe.ingredients.length,
    );
  }
];

<span class="hljs-comment">// Define the custom type</span>
<span class="hljs-keyword">const</span> types = [
  codec(Recipe, <span class="hljs-string">&#x27;Recipe&#x27;</span>, {
    encode(recipe: Recipe): NativelyStorable {
      <span class="hljs-keyword">return</span> {
        name: recipe.name,
        servings: recipe.servings,
        url: recipe.url,
        ingredients: recipe.ingredients,
      };
    },
    decode(encoded: <span class="hljs-built_in">any</span>): Recipe {
      <span class="hljs-keyword">const</span> { name, url, servings, ingredients } = encoded;
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Recipe(name, url, servings, ingredients);
    },
  }),
];

<span class="hljs-comment">// Let typescript know about the custom type</span>
<span class="hljs-keyword">interface</span> Recipe {
  [encodesTo]: NativelyStorable;
}

<span class="hljs-comment">// Create the database!</span>
<span class="hljs-keyword">const</span> jine = <span class="hljs-keyword">new</span> Database&lt;$$&gt;(<span class="hljs-string">&#x27;recipes&#x27;</span>, { migrations, types });


<span class="hljs-comment">// Open a connection to the database (if top-level await isn&#x27;t available)</span>
jine.connect(<span class="hljs-keyword">async</span> conn =&gt; {



<span class="hljs-comment">// == // == // POPULATION // == // == //</span>

<span class="hljs-comment">// Some recipes</span>
<span class="hljs-keyword">const</span> pancakes = <span class="hljs-keyword">new</span> Recipe(
  <span class="hljs-string">&quot;Todd&#x27;s Famous Blueberry Pancakes&quot;</span>,  <span class="hljs-comment">// (who the hell is Todd??)</span>
  <span class="hljs-string">&#x27;allrecipes.com/recipe/20177&#x27;</span>,
  <span class="hljs-number">6</span>,
  [<span class="hljs-string">&#x27;flour&#x27;</span>, <span class="hljs-string">&#x27;eggs&#x27;</span>, <span class="hljs-string">&#x27;salt&#x27;</span>, <span class="hljs-string">&#x27;milk&#x27;</span>, <span class="hljs-string">&#x27;baking powder&#x27;</span>, <span class="hljs-string">&#x27;butter&#x27;</span>,
   <span class="hljs-string">&#x27;white sugar&#x27;</span>, <span class="hljs-string">&#x27;blueberries&#x27;</span>],
);
<span class="hljs-keyword">const</span> waffles = <span class="hljs-keyword">new</span> Recipe(
  <span class="hljs-string">&#x27;Cinnamon Roll Waffles&#x27;</span>,
  <span class="hljs-string">&#x27;allrecipes.com/recipe/240386&#x27;</span>,
  <span class="hljs-number">6</span>,
  [<span class="hljs-string">&#x27;flour&#x27;</span>, <span class="hljs-string">&#x27;brown sugar&#x27;</span>, <span class="hljs-string">&#x27;white sugar&#x27;</span>, <span class="hljs-string">&#x27;butter&#x27;</span>,
   <span class="hljs-string">&#x27;baking powder&#x27;</span>, <span class="hljs-string">&#x27;cinnamon&#x27;</span>, <span class="hljs-string">&#x27;salt&#x27;</span>, <span class="hljs-string">&#x27;milk&#x27;</span>, <span class="hljs-string">&#x27;eggs&#x27;</span>,
   <span class="hljs-string">&#x27;vanilla extract&#x27;</span>, <span class="hljs-string">&#x27;confectioners sugar&#x27;</span>, <span class="hljs-string">&#x27;cream cheese&#x27;</span>],
);
<span class="hljs-keyword">const</span> biscuits = <span class="hljs-keyword">new</span> Recipe(
  <span class="hljs-string">&#x27;Basic Biscuits&#x27;</span>,
  <span class="hljs-string">&#x27;allrecipes.com/recipe/20075&#x27;</span>,
  <span class="hljs-number">10</span>,
  [<span class="hljs-string">&#x27;flour&#x27;</span>, <span class="hljs-string">&#x27;baking powder&#x27;</span>, <span class="hljs-string">&#x27;salt&#x27;</span>, <span class="hljs-string">&#x27;shortening&#x27;</span>, <span class="hljs-string">&#x27;milk&#x27;</span>],
);
<span class="hljs-keyword">const</span> tacros = <span class="hljs-keyword">new</span> Recipe(
  <span class="hljs-string">&#x27;Tacros&#x27;</span>,  <span class="hljs-comment">// croissant tacos... apparently</span>
  <span class="hljs-string">&#x27;allrecipes.com/recipe/262970&#x27;</span>,
  <span class="hljs-number">10</span>,
  [<span class="hljs-string">&#x27;masa harina&#x27;</span>, <span class="hljs-string">&#x27;bread flour&#x27;</span>, <span class="hljs-string">&#x27;vital wheat gluten&#x27;</span>,
   <span class="hljs-string">&#x27;white sugar&#x27;</span>, <span class="hljs-string">&#x27;salt&#x27;</span>, <span class="hljs-string">&#x27;instant yeast&#x27;</span>, <span class="hljs-string">&#x27;milk&#x27;</span>, <span class="hljs-string">&#x27;lard&#x27;</span>,
   <span class="hljs-string">&#x27;butter&#x27;</span>],
);

<span class="hljs-comment">// Add the recipes!</span>
<span class="hljs-keyword">await</span> conn.$.recipes.add(pancakes);
<span class="hljs-keyword">await</span> conn.$.recipes.add(waffles);
<span class="hljs-keyword">await</span> conn.$.recipes.add(biscuits);
<span class="hljs-keyword">await</span> conn.$.recipes.add(tacros);



<span class="hljs-comment">// == // == // QUERIES // == // == //</span>

<span class="hljs-comment">// I have a recipe&#x27;s name</span>
assert.deepEqual(biscuits, <span class="hljs-keyword">await</span> conn.$.recipes.by.name.getOne(<span class="hljs-string">&#x27;Basic Biscuits&#x27;</span>));
<span class="hljs-comment">// Note that the returned item is correctly of rich type `Recipe`!</span>
<span class="hljs-comment">// .selectOne only works on unique indexes and returns one item, or errors if no item is found</span>

<span class="hljs-comment">// I have some eggs I want to cook</span>
<span class="hljs-keyword">const</span> eggRecipes = <span class="hljs-keyword">await</span> conn.$.recipes.by.ingredients.getAll(<span class="hljs-string">&#x27;eggs&#x27;</span>);
assert.deepEqual([pancakes, waffles], eggRecipes);
<span class="hljs-comment">// .find returns all items matching a given trait</span>

<span class="hljs-comment">// I&#x27;m gonna have a lot of guests over</span>
<span class="hljs-keyword">const</span> partyRecipes = <span class="hljs-keyword">await</span> conn.$.recipes.by.servings.select({ above: <span class="hljs-number">7</span> }).array()
assert.deepEqual([biscuits, tacros], partyRecipes);
<span class="hljs-comment">// It&#x27;s just me for this meal, and I don&#x27;t want leftovers</span>
<span class="hljs-keyword">const</span> aloneRecipes = <span class="hljs-keyword">await</span> conn.$.recipes.by.servings.select({ below: <span class="hljs-number">3</span> }).array()
assert.deepEqual([], aloneRecipes);
<span class="hljs-comment">// I want to try something complicated</span>
<span class="hljs-keyword">const</span> complexRecipes = <span class="hljs-keyword">await</span> conn.$.recipes.by.ingredientCount.select({ above: <span class="hljs-number">10</span> }).array();
assert.deepEqual([waffles], complexRecipes);
<span class="hljs-comment">// .select accepts queries in the form:</span>
<span class="hljs-comment">//   { above  : val }  for x &gt; val</span>
<span class="hljs-comment">//   { from   : val }  for x &gt;= val</span>
<span class="hljs-comment">//   { below  : val }  for x &lt; val</span>
<span class="hljs-comment">//   { through: val }  for x &lt;= val</span>
<span class="hljs-comment">//   { above: lo, below  : hi }  for lo &lt; x &lt; hi</span>
<span class="hljs-comment">//   { from : lo, below  : hi }  for lo &lt;= x &lt; hi</span>
<span class="hljs-comment">//   { above: lo, through: hi }  for lo &lt; x &lt;= hi</span>
<span class="hljs-comment">//   { from : lo, through: hi }  for lo &lt;= x &lt;= hi</span>
<span class="hljs-comment">//   { equals: val }  for x === val</span>
<span class="hljs-comment">//   &#x27;everything&#x27;  for everything</span>

<span class="hljs-comment">// Just want to know how many recipes I have</span>
assert.equal(<span class="hljs-number">4</span>, <span class="hljs-keyword">await</span> conn.$.recipes.count());



<span class="hljs-comment">// == // == // TRANSACTIONS // == // == //</span>

<span class="hljs-keyword">const</span> beforeCount = <span class="hljs-keyword">await</span> conn.$.recipes.count();

<span class="hljs-keyword">const</span> bananaBread = <span class="hljs-keyword">new</span> Recipe(
  <span class="hljs-string">&quot;Joy&#x27;s Easy Banana Bread&quot;</span>,
  <span class="hljs-string">&#x27;allrecipes.com/recipe/241707&#x27;</span>,
  <span class="hljs-number">10</span>,
  [<span class="hljs-string">&#x27;bananas&#x27;</span>, <span class="hljs-string">&#x27;white sugar&#x27;</span>, <span class="hljs-string">&#x27;egg&#x27;</span>, <span class="hljs-string">&#x27;butter&#x27;</span>, <span class="hljs-string">&#x27;flour&#x27;</span>,
   <span class="hljs-string">&#x27;baking soda&#x27;</span>, <span class="hljs-string">&#x27;salt&#x27;</span>],
);

<span class="hljs-keyword">await</span> conn.transact([conn.$.recipes], <span class="hljs-string">&#x27;rw&#x27;</span>, <span class="hljs-keyword">async</span> tx =&gt; {
  <span class="hljs-keyword">await</span> tx.$.recipes.add(bananaBread);
  tx.abort();
  <span class="hljs-comment">// or throw Error();</span>
});

<span class="hljs-keyword">const</span> afterCount = <span class="hljs-keyword">await</span> conn.$.recipes.count();
assert.equal(beforeCount, afterCount);  <span class="hljs-comment">// transaction atomically aborted</span>

<span class="hljs-keyword">await</span> conn.transact([conn.$.recipes], <span class="hljs-string">&#x27;rw&#x27;</span>, <span class="hljs-keyword">async</span> tx =&gt; {
  <span class="hljs-comment">// Transactions are auto-committed when not in use</span>
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">0</span>));
  <span class="hljs-comment">// The following is now an error:</span>
  assert.rejects(tx.$.recipes.add(bananaBread));
});



<span class="hljs-comment">// == // == // RESET // == // == //</span>

<span class="hljs-keyword">await</span> conn.$.recipes.clear();
assert.equal(<span class="hljs-number">0</span>, <span class="hljs-keyword">await</span> conn.$.recipes.count());




});</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Overview</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="introduction.html">Introduction</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="installation.html">Installation</a>
					</li>
					<li class="current pp-nav pp-page">
						<a href="example.html">Example</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>In-<wbr><wbr>Depth</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../In-Depth/versioning.html">Versioning</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../In-Depth/custom-types.html">Custom <wbr>Types</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class="globals  ">
						<a href="../../globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>